<p><a href="https://github.com/freddiefujiwara/extract-content-speak-ja/actions/workflows/node.js.yml"><img src="https://github.com/freddiefujiwara/extract-content-speak-ja/actions/workflows/node.js.yml/badge.svg" alt="Node.js CI"></a></p>
<h1 id="extract-content-speak-ja">extract-content-speak-ja</h1>
<p>A Bookmarklet that extracts text and speaks (Japanese only)</p>
<h1 id="how-to-install">How to install</h1>
<p><img src="https://freddiefujiwara.com/extract-content-speak-ja/HowToInstall.gif" alt="How to install"></p>
<ol>
<li>go to <a href="https://freddiefujiwara.com/extract-content-speak-ja/">freddiefujiwara.com/extract-content-speak-ja</a></li>
<li>drag &quot;ExtractContentSpeakJa&quot; to your bookmark bar</li>
<li>go to targer japanese page ( ex . <a href="http://k.nhk.jp/knews/20210723/k10013155501000.html">http://k.nhk.jp/knews/20210723/k10013155501000.html</a> )</li>
<li>Click &quot;ExtractContentSpeakJa&quot; on your bookmark bar</li>
</ol>
<h1 id="how-to-build">How to build</h1>
<pre><code class="lang-bash">$ git submodule update --init --recursive
$ npm i
$ npm run build
</code></pre>
<h1 id="license">License</h1>
<p>Copyright (c) 2021 Fumikazu Fujiwara <a href="mailto:&#x67;&#x69;&#x74;&#x68;&#x75;&#x62;&#64;&#122;&#101;&#46;&#103;&#115;">&#x67;&#x69;&#x74;&#x68;&#x75;&#x62;&#64;&#122;&#101;&#46;&#103;&#115;</a></p>
<p>Released under the MIT license.
see <a href="https://opensource.org/licenses/MIT">https://opensource.org/licenses/MIT</a></p>
<p>The Class ExtractContentJS is:
MIT license | <a href="https://github.com/hatena/extract-content-javascript#label-LICENCE">https://github.com/hatena/extract-content-javascript#label-LICENCE</a></p>

<a href="javascript:/*!%20For%20license%20information%20please%20see%20bookmarklet.min.js.LICENSE.txt%20*/ (()=%3E{if(void%200===t)var%20t={};var%20n,e;void%200===t.Lib%26%26(t.Lib={}),t.Lib.Util=n={BenchmarkTimer:function(){var%20t=function(){var%20t=new%20Date;return%201e3*(60*(60*t.getHours()+t.getMinutes())+t.getSeconds())+t.getMilliseconds()},n=function(){var%20n={elapsed:0,reset:function(){return%20n.elapsed=0,n},start:function(){return%20n.msec=t(),n},stop:function(){return%20n.elapsed+=t()-n.msec,n}};return%20n.start()},e={timers:{},get:function(t){return%20e.timers[t]||(e.timers[t]=new%20n),e.timers[t]},reset:function(t){return%20e.get(t).reset()},start:function(t){return%20e.get(t).start()},stop:function(t){return%20e.get(t).stop()}};return%20e},Token:function(t){var%20n={hiragana:/[\u3042-\u3093\u304C-\u307C\u3041-\u3087\u308E\u3063\u30FC]/,katakana:/[\u30A2-\u30F3\u30AC-\u30DC\u30A1-\u30E7\u30EE\u30C3\u30FC]/,kanji:{test:function(t){return%22一%22%3C=t%26%26t%3C=%22龠%22||%22々%22===t}},alphabet:/[a-zA-Z]/,digit:/[0-9]/},e=function(t){var%20e={};for(var%20r%20in%20n)n[r].test(t)%26%26(e[r]=n[r]);return%20e},r={first:e(t.charAt(0)),last:e(t.charAt(t.length-1)),isTokenized:function(t,n){var%20e=t.length%3Ft.charAt(t.length-1):%22%22,o=n.length%3Fn.charAt(0):%22%22,i=function(t,n){if(t.length)for(var%20e%20in%20n)if(n[e].test(t))return!1;return!0};return%20i(e,r.first)%26%26i(o,r.last)}};return%20r},inherit:function(t,n){var%20e=t||{};for(var%20r%20in%20n)void%200===e[r]%26%26(e[r]=n[r]);return%20e},countMatch:function(t,n){return%20t.split(n).length-1},countMatchTokenized:function(t,e){for(var%20r=0,o=null,i=new%20n.Token(e),a=t.split(e),u=a.length,c=0;c%3Cu;c++)o%26%26i.isTokenized(o,a[c])%26%26r++,o=a[c];return%20r},indexOfTokenized:function(t,e){var%20r=t.indexOf(e);if(r%3E=0){var%20o=new%20n.Token(e),i=r%3E1%3Ft.substr(r-1,1):%22%22,a=t.substr(r+e.length,1);if(o.isTokenized(i,a))return%20r}return-1},dump:function(t){if(void%200===t)return%22undefined%22;if(%22string%22==typeof%20t)return'%22'+t+'%22';if(%22object%22!=typeof%20t)return%22%22+t;if(null===t)return%22null%22;if(t%20instanceof%20Array)return%22[%22+t.map((function(t){return%22obj%22})).join(%22,%22)+%22]%22;var%20n=[];for(var%20e%20in%20t)n.push(e+%22:obj%22);return%22{%22+n.join(%22,%22)+%22}%22}},t.Lib.A=((e={}).indexOf=Array.indexOf||function(t,n){var%20e=2,r=t.length,o=Number(arguments[e++])||0;for((o=o%3C0%3FMath.ceil(o):Math.floor(o))%3C0%26%26(o+=r);o%3Cr;o++)if(o%20in%20t%26%26t[o]===n)return%20o;return-1},e.filter=Array.filter||function(t,n){var%20e=2,r=t.length;if(%22function%22!=typeof%20n)throw%20new%20TypeError(%22A.filter:%20not%20a%20function%22);for(var%20o=new%20Array,i=arguments[e++],a=0;a%3Cr;a++)if(a%20in%20t){var%20u=t[a];n.call(i,u,a,t)%26%26o.push(u)}return%20o},e.forEach=Array.forEach||function(t,n){var%20e=2,r=t.length;if(%22function%22!=typeof%20n)throw%20new%20TypeError(%22A.forEach:%20not%20a%20function%22);for(var%20o=arguments[e++],i=0;i%3Cr;i++)i%20in%20t%26%26n.call(o,t[i],i,t)},e.every=Array.every||function(t,n){var%20e=2,r=t.length;if(%22function%22!=typeof%20n)throw%20new%20TypeError(%22A.every:%20not%20a%20function%22);for(var%20o=arguments[e++],i=0;i%3Cr;i++)if(i%20in%20t%26%26!n.call(o,t[i],i,t))return!1;return!0},e.map=Array.map||function(t,n){var%20e=2,r=t.length;if(%22function%22!=typeof%20n)throw%20new%20TypeError(%22A.map:%20not%20a%20function%22);for(var%20o=new%20Array(r),i=arguments[e++],a=0;a%3Cr;a++)a%20in%20t%26%26(o[a]=n.call(i,t[a],a,t));return%20o},e.some=Array.some||function(t,n){var%20e=2,r=t.length;if(%22function%22!=typeof%20n)throw%20new%20TypeError(%22A.some:%20not%20a%20function%22);for(var%20o=arguments[e++],i=0;i%3Cr;i++)if(i%20in%20t%26%26n.call(o,t[i],i,t))return!0;return!1},e.reduce=Array.reduce||function(t,n){var%20e=2,r=t.length;if(%22function%22!=typeof%20n)throw%20TypeError(%22A.reduce:%20not%20a%20function%20%22);var%20o=0;if(arguments.length%3Ee)var%20i=arguments[e++];else%20for(;;){if(o%20in%20t){i=t[o++];break}if(++o%3E=r)throw%20new%20TypeError(%22A.reduce:%20empty%20array%22)}for(;o%3Cr;o++)o%20in%20t%26%26(i=n.call(null,i,t[o],o,t));return%20i},e.zip=function(t){if(t[0]instanceof%20Array){for(var%20n=t[0].length,e=t.length,r=new%20Array(n),o=0;o%3Cn;o++){r[o]=[];for(var%20i=0;i%3Ce;i++)r[o].push(t[i][o])}return%20r}return[]},e.first=function(t){return%20t%3Ft[0]:null},e.last=function(t){return%20t%3Ft[t.length-1]:null},e.push=function(t,n){return%20Array.prototype.push.apply(t,n)},e),t.Lib.DOM=function(){var%20n=t.Lib.A,e={getElementStyle:function(t,n){var%20e=t.style%3Ft.style[n]:null;if(!e){var%20r=t.ownerDocument.defaultView;if(r%26%26r.getComputedStyle){try{var%20o=r.getComputedStyle(t,null)}catch(t){return%20null}n=n.replace(/([A-Z])/g,%22-$1%22).toLowerCase(),e=o%3Fo.getPropertyValue(n):null}else%20t.currentStyle%26%26(e=t.currentStyle[n])}return%20e},text:function(t){return%20void%200!==t.textContent%3Ft.textContent:%22%23text%22==t.nodeName%3Ft.nodeValue:void%200!==t.innerText%3Ft.innerText:null},ancestors:function(t){for(var%20n=t.ownerDocument.body,e=[],r=t;r!=n;)e.push(r),r=r.parentNode;return%20e.push(n),e},commonAncestor:function(t,n){for(var%20r=e.ancestors(t).reverse(),o=e.ancestors(n).reverse(),i=null,a=0;r[a]%26%26o[a]%26%26r[a]==o[a];a++)i=r[a];return%20i},countMatchTagAttr:function(t,r,o,i){if((t.tagName||%22%22).toLowerCase()==r%26%26n.some(i,(function(n){return%20n.test(t[o])})))return%201;for(var%20a=0,u=t.childNodes,c=0,s=u.length;c%3Cs;c++)a+=e.countMatchTagAttr(u[c],r,o,i);return%20a},matchTag:function(t,r){return%20n.some(r,(function(n){return%22string%22==typeof%20n%3Fn==(t.tagName||%22%22).toLowerCase():n%20instanceof%20Array%26%26n[0]==(t.tagName||%22%22).toLowerCase()%26%26e.matchAttr(t,n[1])}))},matchAttr:function(t,r){var%20o=function(r,i){if(%22string%22==typeof%20r)return%20r==i;if(r%20instanceof%20RegExp)return%20r.test(i);if(r%20instanceof%20Array)return%20n.some(r,(function(t){return%20o(t,i)}));if(r%20instanceof%20Object)for(var%20a%20in%20r){var%20u=t[a];if(u%26%26e.matchAttr(u,r[a]))return!0}return!1};for(var%20i%20in%20r){var%20a=t[i],u=r[i];if(a)return%20o(u,a)}return!1},matchStyle:function(t,r){var%20o=function(t,e){return%22string%22==typeof%20t%3Ft==e:t%20instanceof%20RegExp%3Ft.test(e):t%20instanceof%20Array%26%26n.some(t,(function(t){return%20o(t,e)}))};for(var%20i%20in%20r)if(o(r[i],e.getElementStyle(t,i)))return!0;return!1}};return%20e}(),void%200===t%26%26(t={}),function(t){var%20n=t.Lib.Util,e=t.Lib.A,r=t.Lib.DOM,o=n.inherit((function(t){var%20n=arguments[1]||0,e=arguments[2]||{},o=arguments[3]||1048576,i={node:t,depth:n,inside:e,statistics:function(){var%20n=(r.text(t)||%22%22).replace(/\s+/g,%22%20%22),i=n.length;return{text:n.substr(0,o),noLinkText:e.link||e.form%3F%22%22:n,listTextLength:e.list%3Fi:0,noListTextLength:e.list%3F0:i,linkCount:e.link%3F1:0,listCount:e.li%3F1:0,linkListCount:e.li%26%26e.link%3F1:0}}};return%20i}),{commonAncestor:function(){var%20t=e.map(arguments,(function(t){return%20t.node}));return%20t.length%3C2%3Ft[0]:e.reduce(t,(function(t,n){return%20r.commonAncestor(t,n)}))},mergeStatistics:function(t,n){var%20e={};for(var%20r%20in%20t)e[r]=t[r]+n[r];return%20e}}),i=function(t){var%20n={score:0,leaves:t=e.filter(t,(function(t){var%20n=r.text(t.node)||%22%22;return%200!=(n=n.replace(/\s+/g,%22%22)).length})),commonAncestor:function(){return%20o.commonAncestor.apply(null,n.leaves)}};return%20n},a=function(t){var%20n={_content:t,asLeaves:function(){return%20n._content},asNode:function(){return%20n._node||(n._node=o.commonAncestor.apply(null,n._content)),n._node},asTextFragment:function(){return%20n._textFragment%3Fn._textFragment:n._content.length%3C1%3F%22%22:(n._textFragment=e.reduce(n._content,(function(t,n){var%20e=r.text(n.node);return%20t+(e=e.replace(/^\s+/g,%22%22).replace(/\s+$/g,%22%22)).replace(/\s+/g,%22%20%22)}),%22%22),n._textFragment)},asText:function(){if(n._text)return%20n._text;var%20t=n.asNode();return%20n._text=t%3Fr.text(t):%22%22,n._text},toString:function(){return%20n.asTextFragment()}};return%20n};t.LayeredExtractor=function(){var%20n={handler:arguments[0]||[],filter:arguments[1]||{}};return%20n.factory={getHandler:function(n){return%20void%200!==t.LayeredExtractor.Handler%3Fnew%20t.LayeredExtractor.Handler[n]:null}},n.addHandler=function(t){return%20void%200!==t%26%26n.handler.push(t),n},n.filterFor=function(t){},n.extract=function(t){for(var%20e=t.location.href,r={title:t.title,url:t.location.href},o=n.handler.length,i=0;i%3Co;i++){var%20u=n.handler[i].extract(t,e,r);if(u){var%20c=n.filterFor(e);if(c%26%26(u=c.filter(u)),(u=new%20a(u)).toString().length){r.content=u,r.isSuccess=!0,r.engine=r.engine||n.handler[i];break}}}return%20r},n},t.LayeredExtractor.Handler={},t.LayeredExtractor.Handler.Heuristics=function(){var%20t={name:%22Heuristics%22,content:[],opt:n.inherit(arguments[0],{threshold:60,minLength:30,factor:{decay:.75,noBody:.72,continuous:1.16},punctuationWeight:10,minNoLink:8,noListRatio:.2,limit:{leaves:800,recursion:20,text:1048576},debug:!1}),pat:n.inherit(arguments[1],{sep:[%22div%22,%22center%22,%22td%22,%22h1%22,%22h2%22],waste:[/Copyright|All\s*Rights%3F\s*Reserved%3F/i],affiliate:[/amazon[a-z0-9\.\/\-\%3F%26]+-22/i],list:[%22ul%22,%22dl%22,%22ol%22],li:[%22li%22,%22dd%22],a:[%22a%22],form:[%22form%22],noContent:[%22frameset%22],ignore:[%22iframe%22,%22img%22,%22script%22,%22style%22,%22select%22,%22noscript%22,[%22div%22,{id:[/more/,/menu/,/side/,/navi/],className:[/more/,/menu/,/side/,/navi/]}]],ignoreStyle:{display:%22none%22,visibility:%22hidden%22},punctuations:/[\u3002\u3001\uFF0E\uFF0C\uFF01\uFF1F]|\.[^A-Za-z0-9]|,[^0-9]|!|\%3F/})},a=n.inherit((function(a){var%20u=new%20i(a);return%20u.eliminateLinks=function(){var%20n=e.map(u.leaves,(function(t){return%20t.statistics()}));if(!n.length)return%22%22;var%20r=(n=1==n.length%3Fn[0]:e.reduce(n,(function(t,n){return%20o.mergeStatistics(t,n)}))).noLinkText.length,i=n.linkCount,a=n.listTextLength;if(r%3Ct.opt.minNoLink*i)return%22%22;var%20c=n.linkListCount/(n.listCount||1);return%20c*=c,r%3Ct.opt.noListRatio*c*a%3F%22%22:n.noLinkText},u.noBodyRate=function(){var%20o=0;return%20u.leaves.length%3E0%26%26(o+=e.reduce(u.leaves,(function(n,e){return%20n+r.countMatchTagAttr(e.node,%22a%22,%22href%22,t.pat.affiliate)}),0)),(o/=2)+e.reduce(t.pat.waste,(function(t,e){return%20t+n.countMatch(u._nolink,e)}),0)},u.calcScore=function(e,r){if(u._nolink=u.eliminateLinks(),u._nolink.length%3Ct.opt.minLength)return%200;var%20o=n.countMatch(u._nolink,t.pat.punctuations);o*=t.opt.punctuationWeight,o+=u._nolink.length,o*=e;var%20i=u.noBodyRate();return%20o*=Math.pow(t.opt.factor.noBody,i),u._c=u.score=o,u._c1=o*r,o},u.isAccepted=function(){return%20u._c%3Et.opt.threshold},u.isContinuous=function(){return%20u._c1%3Et.opt.threshold},u.merge=function(t){return%20u.score+=t._c1,u.depth=Math.min(u.depth,t.depth),e.push(u.leaves,t.leaves),u},u}),{split:function(n){var%20e=[],i=[],u=0,c=t.opt.limit.text,s=function(t){t%26%26i.length%26%26(e.push(new%20a(i)),i=[])},f=function(n,a,l){if(u%3E=t.opt.limit.leaves)return%20e;if(a%3E=t.opt.limit.recursion)return%20e;if(%22%23comment%22==n.nodeName)return%20e;if(r.matchTag(n,t.pat.ignore))return%20e;if(r.matchStyle(n,t.pat.ignoreStyle))return%20e;for(var%20h=n.childNodes,d=t.pat.sep,g=h.length,p={form:l.form||r.matchTag(n,t.pat.form),link:l.link||r.matchTag(n,t.pat.a),list:l.list||r.matchTag(n,t.pat.list),li:l.li||r.matchTag(n,t.pat.li)},v=0;v%3Cg;v++){var%20m=h[v],y=r.matchTag(m,d);s(y),f(m,a+1,p),s(y)}return%20g||(u++,i.push(new%20o(n,a,p,c))),e};return%20f(n,0,{}),s(!0),e}});return%20t.extract=function(n){if(e.some(t.pat.noContent,(function(t){return%200!=n.getElementsByTagName(t).length})))return%20t;for(var%20r,o=1,i=1,u=[],c=a.split(n.body),s=c.length,f=0;f%3Cs;f++){var%20l=c[f];r%26%26(i/=t.opt.factor.continuous),l.calcScore(o,i)%26%26(o*=t.opt.factor.decay,l.isAccepted()%3F(l.isContinuous()%26%26r%3Fr.merge(l):(r=l,u.push(l)),i=t.opt.factor.continuous):r||(o=1))}t.blocks=u.sort((function(t,n){return%20n.score-t.score}));var%20h=e.first(t.blocks);return%20h%26%26(t.content=h.leaves),t.content},t},t.LayeredExtractor.Handler.GoogleAdSection=function(){var%20t={name:%22GoogleAdSection%22,content:[],state:[],opt:n.inherit(arguments[0],{limit:{leaves:800,recursion:20},debug:!1})},r={ignore:/google_ad_section_start\(weight=ignore\)/i,section:/google_ad_section_start/i,end:/google_ad_section_end/i},a=1,u=2;return%20t.inSection=function(){return%20e.last(t.state)==u},t.ignore=function(){t.state.push(a)},t.section=function(){t.state.push(u)},t.end=function(){t.state.length%26%26t.state.pop()},t.parse=function(n){var%20e=arguments[1]||0;if(%22%23comment%22!=n.nodeName){if(!(t.content.length%3E=t.opt.limit.leaves||e%3E=t.opt.limit.recursion)){for(var%20i=n.childNodes,a=i.length,u=0;u%3Ca;u++){var%20c=i[u];t.parse(c,e+1)}!a%26%26t.inSection()%26%26t.content.push(new%20o(n,e))}}else%20r.ignore.test(n.nodeValue)%3Ft.ignore():r.section.test(n.nodeValue)%3Ft.section():r.end.test(n.nodeValue)%26%26t.end()},t.extract=function(n){return%20t.parse(n),t.blocks=[new%20i(t.content)],t.content},t}}(t),function(){const%20n=new%20t.LayeredExtractor;n.addHandler(n.factory.getHandler(%22Heuristics%22));const%20e=n.extract(window.document);if(e.isSuccess%26%26window.speechSynthesis){const%20t=window.speechSynthesis;t.cancel();const%20n=new%20SpeechSynthesisUtterance(e.content.toString());n.lang=%22ja-JP%22,t.speak(n)}}()})();">ExtractContentSpeakJa</a>
